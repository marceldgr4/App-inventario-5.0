<script>
  (function () {
    // ===================================================
    // --- ESTADO Y CONFIGURACIÓN DEL MÓDULO DECORACION ---
    // ===================================================
    const pageState = {
      fullData: [],
      datosMostrados: [],
      currentPage: 1,
      itemsPerPage: 10,
      productoAEditarId: null,
      productoRetiroSeleccionado: null,
      productoComentarioSeleccionado: null,
      fechaOrdenAscendente: false,
      criterioDeOrden: "Id",
    };

    console.log("[INFO] Js_Decoracion cargado correctamente.");

    function loadDecoracion() {
      loadDataGenerico({
        endpoint: "getDecoracionData",
        tbodyId: "tablaDecoracionBody",
        noDataId: "noData",
        containerId: "tableContainerDecoracion",
        onSuccess: function (data) {
          pageState.fullData = data || [];
          pageState.currentPage = 1;
          aplicarFiltrosYOrdenarDecoracion();
          if (pageState.fullData.length === 0) {
            const tbody = document.getElementById("tablaDecoracionBody");
            if (tbody)
              tbody.innerHTML =
                "<tr><td colspan='10' style='text-align:center;'>No hay datos de papelería</td></tr>";
            const pag = document.getElementById("decoracionPagination");
            if (pag) pag.innerHTML = "";
          } else {
            renderPaginatedTable();
          }
        },
        onError: function () {
          hideLoading();
        },
      });
    }

    // === render fila ===
    function rowRenderer(item) {
      const id = item.Id || "";
      const producto = item.PRODUCTO || "";
      const tipo = item.TIPO || "";
      const fechaIngreso = formatDate(item["FECHA DE INGRESO"]);
      const ingresos = item.Ingresos || 0;
      const salidas = item.Salidas || 0;
      const disponibles = parseInt(item["Unidades disponibles"]) || 0;
      const precio = item.PRECIO || "0";
      const comentarios = item.COMENTARIOS || "";
      const estado = item.ESTADO || "";

      return `
      <td>${id}</td>
      <td>${producto}</td>
      <td>${tipo}</td>
      <td>${fechaIngreso}</td>
      <td>${ingresos}</td>
      <td>${salidas}</td>
      <td class="${disponibles === 0 ? "agotado" : ""}">${disponibles}</td>
      <td>${precio}</td>
      <td>${comentarios}</td>
      <td>${estado}</td>
      <td>
        <button class="btn-modificar" title="Editar" onclick="abrirModalEditar('${id}')"><ion-icon name="create-outline"></ion-icon></button>
        <button class="btn-retirar" title="Retirar" onclick="abrirModalRetiro('${id}', '${producto}', ${disponibles})"><ion-icon name="bag-handle-outline"></ion-icon></button>
        <button class="btn-comentario" title="Comentar" onclick="abrirModalComentario('${id}', '${producto}')"><ion-icon name="chatbubbles-outline"></ion-icon></button>
        <button class="btn-eliminar" title="Desactivar" onclick="confirmarEliminar('${id}', '${producto}')"><ion-icon name="trash-bin-outline"></ion-icon></button>
      </td>
    `;
    }

    // === paginación y render tabla ===
    function renderPaginatedTable() {
      const tbody = document.getElementById("tablaDecoracionBody");
      if (!tbody) {
        console.error("[ERROR] No tbody 'tablaDecoracionBody'");
        return;
      }
      tbody.innerHTML = "";
      if (!pageState.datosMostrados || pageState.datosMostrados.length === 0) {
        tbody.innerHTML =
          "<tr><td colspan='12' style='text-align:center;'>No hay productos que coincidan con los filtros.</td></tr>";
        document.getElementById("decoracionPagination").innerHTML = "";
        return;
      }
      const totalPages = Math.ceil(
        pageState.datosMostrados.length / pageState.itemsPerPage
      );
      if (pageState.currentPage > totalPages) pageState.currentPage = 1;
      const start = (pageState.currentPage - 1) * pageState.itemsPerPage;
      const paginatedItems = pageState.datosMostrados.slice(
        start,
        start + pageState.itemsPerPage
      );

      paginatedItems.forEach((item) => {
        const row = tbody.insertRow();
        const fechaIngresoStr = item["FECHA DE INGRESO"];
        if (fechaIngresoStr) {
          const fechaIngresoDate = formatDateForComparison(fechaIngresoStr);
          if (fechaIngresoDate) {
            const currentDate = new Date();
            currentDate.setHours(0, 0, 0, 0);
            const oneMonthLater = new Date(currentDate);
            oneMonthLater.setMonth(currentDate.getMonth() + 1);
            if (fechaIngresoDate < currentDate) row.classList.add("vencido");
            else if (fechaIngresoDate.getTime() === currentDate.getTime())
              row.classList.add("vencido-hoy");
            else if (fechaIngresoDate < oneMonthLater)
              row.classList.add("proximo-a-vencer");
          }
        }
        row.innerHTML = rowRenderer(item);
      });
      renderPaginationControls(pageState.datosMostrados.length);
    }

    function renderPaginationControls(totalItems) {
      const paginationDiv = document.getElementById("decoracionPagination");
      paginationDiv.innerHTML = "";
      const totalPages = Math.ceil(totalItems / pageState.itemsPerPage);
      if (totalPages <= 1) return;
      const maxButtons = 5;
      let buttonsHtml = "";
      buttonsHtml += `<button class="page-btn" onclick="changePage(pageState.currentPage - 1)" ${
        pageState.currentPage === 1 ? "disabled" : ""
      }>Anterior</button>`;
      let startPage = Math.max(
        1,
        pageState.currentPage - Math.floor(maxButtons / 2)
      );
      let endPage = Math.min(totalPages, startPage + maxButtons - 1);
      if (endPage === totalPages)
        startPage = Math.max(1, totalPages - maxButtons + 1);
      if (startPage > 1) {
        buttonsHtml += `<button class="page-btn" onclick="changePage(1)">1</button>`;
        if (startPage > 2)
          buttonsHtml += `<span class="pagination-dots">...</span>`;
      }
      for (let i = startPage; i <= endPage; i++) {
        const activeClass = i === pageState.currentPage ? "active" : "";
        buttonsHtml += `<button class="page-btn ${activeClass}" onclick="changePage(${i})">${i}</button>`;
      }
      if (endPage < totalPages) {
        if (endPage < totalPages - 1)
          buttonsHtml += `<span class="pagination-dots">...</span>`;
        buttonsHtml += `<button class="page-btn" onclick="changePage(${totalPages})">${totalPages}</button>`;
      }
      buttonsHtml += `<button class="page-btn" onclick="changePage(pageState.currentPage + 1)" ${
        pageState.currentPage === totalPages ? "disabled" : ""
      }>Siguiente</button>`;
      paginationDiv.innerHTML = buttonsHtml;
    }

    window.changePage = function (page) {
      const totalPages =
        Math.ceil(pageState.datosMostrados.length / pageState.itemsPerPage) ||
        1;
      pageState.currentPage = Math.max(1, Math.min(page, totalPages));
      renderPaginatedTable();
    };

    // === FILTROS y ORDENAMIENTO (corregido: IDs que usa tu HTML) ===
    function aplicarFiltrosYOrdenarDecoracion() {
      aplicarFiltrosYOrdenarGenerico({
        dataSource: pageState.fullData,
        setResultados: (val) => {
          pageState.datosMostrados = val;
          pageState.currentPage = 1;
        },
        fechaOrdenAsc: pageState.fechaOrdenAscendente,
        renderFn: renderPaginatedTable,
        filters: [
          { id: "buscarDecoracion", field: "PRODUCTO", type: "text" }, // input de búsqueda principal
          { id: "filtroTipo", field: "TIPO", type: "text" },
          { id: "filtroEstado", field: "Estado", type: "text" },
        ],
      });
    }
    const aplicarFiltrosYOrdenar = aplicarFiltrosYOrdenarDecoracion;

    function limpiarTodosLosFiltrosDecoracion() {
      limpiarFiltrosGenerico({
        filtros: [
          { id: "buscarDecoracion", type: "text" },
          { id: "filtroFechaIngreso", type: "date" },
          { id: "filtroUnidadesDecoracion", type: "number" },
          { id: "filtroTiempoStorageDecoracion", type: "number" },
          { id: "filtroUbicacionDecoracion", type: "text" },
          {
            id: "filtroEstadoDecoracionSelect",
            type: "select",
            defaultValue: "activo",
          },
        ],
        aplicarFn: aplicarFiltrosYOrdenarDecoracion,
      });
    }

    // === funciones exclusivas ===
    function searchItemsDecoracion() {
      searchItemsGenerico(aplicarFiltrosYOrdenarDecoracion);
    }
    function clearSearchDecoracion() {
      clearSearchGenerico("buscarDecoracion", aplicarFiltrosYOrdenarDecoracion);
    }
    function ordenarPorFechaDecoracion(event) {
      ordenarPorFechaGenerico(event, "sortOptionsDecoracion");
    }
    function ordenarAscendenteDecoracion() {
      ordenarAscendenteGenerico(
        aplicarFiltrosYOrdenarDecoracion,
        "sortOptionsDecoracion",
        (val) => (pageState.fechaOrdenAscendente = val)
      );
    }
    function ordenarDescendenteDecoracion() {
      ordenarDescendenteGenerico(
        aplicarFiltrosYOrdenarDecoracion,
        "sortOptionsDecoracion",
        (val) => (pageState.fechaOrdenAscendente = val)
      );
    }
    function toggleFiltrosAdicionalesDecoracion() {
      toggleFiltrosAdicionalesGenerico("filtrosAdicionalesContainer");
    }
    function ordenarPorIdRecienteDecoracion() {
      ordenarPorIdRecienteGenerico(
        aplicarFiltrosYOrdenarDecoracion,
        "sortOptionsDecoracion",
        (val) => (pageState.criterioDeOrden = val)
      );
    }

    // === MODALES ===
    function abrirModalAgregar() {
      abrirModal("modalAgregarDecoracion");
      document.getElementById("agregarDecoracionForm").reset();
    }
    function cerrarModalAgregar() {
      cerrarModal("modalAgregarDecoracion");
    }

    function abrirModalEditar(id) {
      const producto = pageState.datosMostrados.find(
        (p) => String(p.Id) === String(id)
      );
      if (!producto) return mostrarMensaje("Producto no encontrado", "error");
      pageState.productoAEditarId = id;
      abrirModal("modalEditarDecoracion");
      document.getElementById("productoIdEditarDecoracion").textContent = id;
      document.getElementById("productoEditar").value =
        producto["PRODUCTO"] || "";
      document.getElementById("ingresosEditar").value = "0";
      // document.getElementById("imagenEditarDecoracion").value = producto["Imagen"] || "";
    }
    function cerrarModalEditar() {
      cerrarModal("modalEditarDecoracion");
    }

    function abrirModalRetiro(id, producto, unidades) {
      pageState.productoRetiroSeleccionado = {
        id,
        producto,
        unidadesDisponibles: unidades,
      };
      abrirModal("modalRetiroDecoracion");
      document.getElementById("productoIdRetiroDecoracion").textContent = id;
      document.getElementById("productoNombreRetiroDecoracion").textContent =
        producto;
      document.getElementById(
        "unidadesDisponiblesRetiroDecoracion"
      ).textContent = unidades;
    }
    function cerrarModalRetiro() {
      cerrarModal("modalRetiroDecoracion");
    }

    function abrirModalComentario(id) {
      const producto = pageState.datosMostrados.find(
        (p) => String(p.Id) === String(id)
      );
      if (!producto) return mostrarMensaje("Producto no encontrado", "error");
      pageState.productoComentarioSeleccionado = {
        Id: id,
        producto: producto["PRODUCTO"],
      };
      abrirModal("modalComentarioDecoracion");
      document.getElementById("comentarioProductoIdDecoracion").textContent =
        id;
      document.getElementById(
        "comentarioProductoNombreDecoracion"
      ).textContent = producto["PRODUCTO"];
    }
    function cerrarModalComentario() {
      cerrarModal("modalComentarioDecoracion");
    }

    // === FORM HANDLERS ===
    document
      .getElementById("agregarDecoracionForm")
      ?.addEventListener("submit", (e) => {
        e.preventDefault();
        const data = {
          productoAgregar: document.getElementById("productoAgregar").value,
          tipoAgregar: document.getElementById("tipoAgregar").value,
          ingresosAgregar: parseFloat(
            document.getElementById("ingresosAgregar").value
          ),
          precioAgregar: document.getElementById("precioAgregar").value,
          imagenArchivo:
            document.getElementById("imagenArchivoAgregar").files[0] || null,
        };

        google.script.run
          .withSuccessHandler((r) =>
            handleServerResponse(
              r,
              () => cerrarModal("modalAgregarDecoracion"),
              loadDecoracion
            )
          )
          .withFailureHandler(handleServerError)
          .agregarDecoracion(data);
      });

    document
      .getElementById("editarDecoracionForm")
      ?.addEventListener("submit", (e) => {
        e.preventDefault();
        const data = {
          idEditar: pageState.productoAEditarId,
          productoEditar: document.getElementById("productoEditar").value,
          tipoEditar: document.getElementById("tipoEditar").value,
          ingresosEditar: parseFloat(
            document.getElementById("ingresosEditar").value
          ),
          precioEditar: document.getElementById("precioEditarDecoracion").value,
        };

        google.script.run
          .withSuccessHandler((r) =>
            handleServerResponse(
              r,
              () => cerrarModal("modalEditarDecoracion"),
              loadDecoracion
            )
          )
          .withFailureHandler(handleServerError)
          .actualizarDecoracion(data);
      });

    document
      .getElementById("retiroDecoracionForm")
      ?.addEventListener("submit", (e) => {
        e.preventDefault();
        const unidades = parseInt(
          document.getElementById("unidadesRetirar").value
        );

        google.script.run
          .withSuccessHandler((r) =>
            handleServerResponse(
              r,
              () => cerrarModal("modalRetiroDecoracion"),
              loadDecoracion
            )
          )
          .withFailureHandler(handleServerError)
          .retirarDecoracion(pageState.productoRetiroSeleccionado.id, unidades);
      });

    const formComentario = document.getElementById("comentarioDecoracionForm");

    formComentario?.addEventListener("submit", function (e) {
      e.preventDefault();
      const comentarioTexto = document
        .getElementById("comentarioTextoDecoracion")
        .value.trim();
      if (!comentarioTexto) {
        return mostrarMensaje("El comentario no puede estar vacío.", "error");
      }

      const { Id, producto } = pageState.productoComentarioSeleccionado;
      const usuario = currentUser ? currentUser.name : "Desconocido";

      registrarComentarioGenerico({
        sheetName: "Decoracion",
        productoId: Id,
        producto: producto,
        comentario: comentarioTexto,
        usuario: usuario,
        reloadFn: cargarNotificacionesDeComentariosDecoracion,
      });
      cerrarModalComentario();
    });

    // === ELIMINAR ===
    function confirmarEliminar(id, producto) {
      if (confirm("¿Desactivar producto " + producto + " (" + id + ")?")) {
        google.script.run
          .withSuccessHandler((r) =>
            handleServerResponse(r, null, loadDecoracion)
          )
          .withFailureHandler(handleServerError)
          .eliminarDecoracion(id);
      }
    }

    // === utility: guardarDecoracion (sin cambios de lógica) ===
    function guardarDecoracion() {
      const inputPrecio = document.getElementById("precioAgregarDecoracion");
      if (!validarFormatoPrecio(inputPrecio)) return;
      const precio = convertirPrecioFormateadoAStringNumericoParaServidor(
        inputPrecio.value
      );
      console.log("💾 Guardar Papelería con precio:", precio);
    }

    // === inicialización ===
    function inicializarPaginaDecoracion() {
      const setupFilterListener = (id, eventType, handler) => {
        const element = document.getElementById(id);
        if (element) element.addEventListener(eventType, handler);
      };
      setupFilterListener("buscarDecoracion", "input", aplicarFiltrosYOrdenar);
      setupFilterListener(
        "filtroUbicacionDecoracion",
        "input",
        aplicarFiltrosYOrdenar
      );
      setupFilterListener(
        "filtroEstadoDecoracionSelect",
        "change",
        aplicarFiltrosYOrdenar
      );
      setupFilterListener(
        "filtroUnidadesDecoracion",
        "input",
        aplicarFiltrosYOrdenar
      );
      setupFilterListener(
        "filtroTiempoStorageDecoracion",
        "input",
        aplicarFiltrosYOrdenar
      );

      const toggleFiltrosBtn = document.getElementById(
        "toggleFiltrosDecoracionIconContainer"
      );
      const filtrosContainer = document.getElementById(
        "filtrosAdicionalesContainer"
      );
      if (toggleFiltrosBtn && filtrosContainer) {
        filtrosContainer.classList.add("filtros-adicionales-ocultos");
        toggleFiltrosBtn.addEventListener(
          "click",
          toggleFiltrosAdicionalesDecoracion
        );
      }

      loadDecoracion();
    }

    registrarEscapeCierraModales([
      cerrarModalAgregar,
      cerrarModalEditar,
      cerrarModalRetiro,
      cerrarModalComentario,
    ]);

    // === EXPONER ALIAS GLOBALES (para que los onclick inline funcionen) ===
    // mapea tanto nombres con sufijo como sin sufijo (para compatibilidad)
    window.abrirModalAgregar = abrirModalAgregar;
    window.cerrarModalAgregar = cerrarModalAgregar;
    window.abrirModalAgregarDecoracion = abrirModalAgregar;
    window.cerrarModalAgregarDecoracion = cerrarModalAgregar;

    window.abrirModalEditar = abrirModalEditar;
    window.cerrarModalEditar = cerrarModalEditar;
    window.abrirModalEditarDecoracion = abrirModalEditar;
    window.cerrarModalEditarDecoracion = cerrarModalEditar;

    window.abrirModalAgregar = abrirModalAgregar;
    window.cerrarModalAgregar = cerrarModalAgregar;
    window.abrirModalEditar = abrirModalEditar;
    window.cerrarModalEditar = cerrarModalEditar;
    window.abrirModalRetiro = abrirModalRetiro;
    window.cerrarModalRetiro = cerrarModalRetiro;
    window.abrirModalComentario = abrirModalComentario;
    window.cerrarModalComentario = cerrarModalComentario;
    window.confirmarEliminar = confirmarEliminar;
    window.confirmarEliminarDecoracion = confirmarEliminar;

    window.aplicarFiltrosYOrdenar = aplicarFiltrosYOrdenar;
    window.aplicarFiltrosYOrdenarDecoracion = aplicarFiltrosYOrdenarDecoracion;
    window.limpiarTodosLosFiltros = limpiarTodosLosFiltrosDecoracion;
    window.limpiarTodosLosFiltrosDecoracion = limpiarTodosLosFiltrosDecoracion;

    window.ordenarPorFecha = ordenarPorFechaDecoracion;
    window.ordenarAscendente = ordenarAscendenteDecoracion;
    window.ordenarDescendente = ordenarDescendenteDecoracion;

    // =================================================
    // --- LÓGICA DE NOTIFICACIONES DE COMENTARIOS ---
    // =================================================

    /**
     * @summary Carga las notificaciones de comentarios pendientes y leídas desde el backend.
     * También actualiza el contador de notificaciones en el botón principal.
     */
    function cargarNotificacionesDeComentariosDecoracion() {
        showLoading(true);
        const origen = "Decoracion"; // Origen específico para esta página

        Promise.all([
            new Promise((resolve, reject) => {
                google.script.run
                    .withSuccessHandler(response => resolve(JSON.parse(response)))
                    .withFailureHandler(reject)
                    .getNotificacionesPendientesUsuario(origen);
            }),
            new Promise((resolve, reject) => {
                google.script.run
                    .withSuccessHandler(response => resolve(JSON.parse(response)))
                    .withFailureHandler(reject)
                    .getNotificacionesLeidasUsuario(origen);
            })
        ]).then(([pendientesResult, leidasResult]) => {
            hideLoading();
            if (pendientesResult.error || leidasResult.error) {
                mostrarMensaje("Error al cargar notificaciones: " + (pendientesResult.error || leidasResult.error), "error");
                return;
            }
            renderNotificacionesPendientesDecoracion(pendientesResult.data || []);
            renderNotificacionesLeidasDecoracion(leidasResult.data || []);
            
            const count = (pendientesResult.data || []).length;
            const notifCountEl = document.getElementById('notificacionCantidadComentarios');
            if (notifCountEl) {
                notifCountEl.textContent = count;
                notifCountEl.style.display = count > 0 ? 'inline-block' : 'none';
            }

        }).catch(error => {
            hideLoading();
            console.error("Error fatal al cargar notificaciones de comentarios:", error);
            mostrarMensaje("Error de conexión al cargar notificaciones.", "error");
        });
    }

    /**
     * @summary Renderiza la tabla de notificaciones pendientes.
     * @param {Array<Object>} data - Array de notificaciones pendientes.
     */
    function renderNotificacionesPendientesDecoracion(data) {
        const tbody = document.getElementById('notificacionesPendientesBody');
        if (!tbody) return;
        tbody.innerHTML = '';
        if (data.length === 0) {
            tbody.innerHTML = '<tr><td colspan="4" style="text-align: center;">No tienes respuestas pendientes.</td></tr>';
            return;
        }
        data.forEach(item => {
            const row = tbody.insertRow();
            row.innerHTML = `
                <td>${escapeHtml(item.Producto)}</td>
                <td>${escapeHtml(item.Comentario)}</td>
                <td>${escapeHtml(item.Respuesta)}</td>
                <td>
                    <button class="btn-confirmar" onclick="confirmarLecturaNotificacionDecoracion(${item.Id})">
                        <ion-icon name="checkmark-done-outline"></ion-icon> Confirmar
                    </button>
                </td>
            `;
        });
    }

    /**
     * @summary Renderiza la tabla de notificaciones leídas.
     * @param {Array<Object>} data - Array de notificaciones leídas.
     */
    function renderNotificacionesLeidasDecoracion(data) {
        const tbody = document.getElementById('notificacionesLeidasBody');
        if (!tbody) return;
        tbody.innerHTML = '';
        if (data.length === 0) {
            tbody.innerHTML = '<tr><td colspan="4" style="text-align: center;">No tienes notificaciones leídas.</td></tr>';
            return;
        }
        data.forEach(item => {
            const row = tbody.insertRow();
            row.innerHTML = `
                <td>${escapeHtml(item.Producto)}</td>
                <td>${escapeHtml(item.Comentario)}</td>
                <td>${escapeHtml(item.Respuesta)}</td>
                <td>
                    <button class="btn-eliminar" onclick="borrarNotificacionUsuarioDecoracion(${item.Id})">
                        <ion-icon name="trash-outline"></ion-icon> Borrar
                    </button>
                </td>
            `;
        });
    }

    /**
     * @summary Maneja el clic en el botón 'Confirmar' de una notificación.
     * @param {number} comentarioId - El ID del comentario a confirmar.
     */
    function confirmarLecturaNotificacionDecoracion(comentarioId) {
        showLoading(true);
        google.script.run
            .withSuccessHandler(response => {
                const result = JSON.parse(response);
                hideLoading();
                if (result.success) {
                    mostrarMensaje("Notificación movida a leídas.", "success");
                    cargarNotificacionesDeComentariosDecoracion(); // Recargar ambas pestañas
                } else {
                    mostrarMensaje("Error: " + result.message, "error");
                }
            })
            .withFailureHandler(handleServerError)
            .confirmarRespuesta(comentarioId);
    }

    /**
     * @summary Maneja el clic en el botón 'Borrar' de una notificación leída.
     * @param {number} comentarioId - El ID del comentario a borrar.
     */
    function borrarNotificacionUsuarioDecoracion(comentarioId) {
        if (!confirm("¿Estás seguro de que quieres borrar esta notificación? No podrás verla de nuevo.")) {
            return;
        }
        showLoading(true);
        google.script.run
            .withSuccessHandler(response => {
                const result = JSON.parse(response);
                hideLoading();
                if (result.success) {
                    mostrarMensaje("Notificación borrada.", "success");
                    cargarNotificacionesDeComentariosDecoracion(); // Recargar para que desaparezca
                } else {
                    mostrarMensaje("Error: " + result.message, "error");
                }
            })
            .withFailureHandler(handleServerError)
            .marcarComentarioBorradoUsuario(comentarioId);
    }
    
    /**
     * @summary Configura los listeners para las pestañas del modal de notificaciones.
     */
    function setupNotificacionTabsDecoracion() {
        const tabContainer = document.querySelector('#modalNotificacion-Comentario .tab-buttons-container');
        if (!tabContainer) return;

        // Prevenir múltiples listeners
        if (tabContainer.dataset.listenerAttached) return;
        tabContainer.dataset.listenerAttached = 'true';

        tabContainer.addEventListener('click', (e) => {
            const button = e.target.closest('.tab-button');
            if (button) {
                const tabId = button.dataset.tab;
                
                document.querySelectorAll('#modalNotificacion-Comentario .tab-content').forEach(content => {
                    content.classList.remove('active');
                    content.style.display = 'none';
                });

                document.querySelectorAll('#modalNotificacion-Comentario .tab-button').forEach(btn => {
                    btn.classList.remove('active');
                });

                const activeContent = document.getElementById(tabId);
                if (activeContent) {
                    activeContent.classList.add('active');
                    activeContent.style.display = 'block';
                }
                button.classList.add('active');
            }
        });
    }

    function abrirModalNotificacionComentario() {
      abrirModal("modalNotificacion-Comentario");
      cargarNotificacionesDeComentariosDecoracion();
    }
    function cerrarModalNotificacionComentario() {
      cerrarModal("modalNotificacion-Comentario");
    }

    // iniciar
    inicializarPaginaDecoracion();
    setupNotificacionTabsDecoracion();
    cargarNotificacionesDeComentariosDecoracion();

    window.abrirModalNotificacionComentario = abrirModalNotificacionComentario;
    window.cerrarModalNotificacionComentario = cerrarModalNotificacionComentario;
    window.cargarNotificacionesDeComentariosDecoracion = cargarNotificacionesDeComentariosDecoracion;
    window.confirmarLecturaNotificacionDecoracion = confirmarLecturaNotificacionDecoracion;
    window.borrarNotificacionUsuarioDecoracion = borrarNotificacionUsuarioDecoracion;
  })();
</script>
